---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import FormattedDate from "../components/FormattedDate.astro";
import GlossaryTerm from "../components/GlossaryTerm.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";

// Get recent articles and tutorials
const articles = (await getCollection("articles"))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3); // Get only the 3 most recent articles

const tutorials = (await getCollection("tutorials"))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3); // Get only the 3 most recent tutorials

// pH data for fermentation timeline visualization
const phData = [6.2, 5.8, 5.1, 4.6, 4.2, 3.9, 3.6, 3.4, 3.3, 3.2, 3.2, 3.2, 3.2, 3.2];
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			main {
				width: 960px;
				max-width: calc(100% - 4em);
				margin: 0 auto;
				padding: 0;
			}

			/* Hero Section - Modernist Cuisine inspired */
			.hero-section {
				display: grid;
				grid-template-columns: 7fr 5fr;
				gap: 2rem;
				padding: 6rem 0;
				align-items: center;
			}

			.hero-content {
				max-width: 600px;
			}

			.hero-tagline {
				font-size: 0.75rem;
				text-transform: uppercase;
				letter-spacing: 0.2em;
				color: var(--accent);
				margin-bottom: 1rem;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.hero-title {
				font-size: 3rem;
				font-weight: 300;
				line-height: 1.15;
				margin-bottom: 1.5rem;
				color: rgb(var(--black));
			}

			.hero-description {
				font-size: 1.125rem;
				color: rgb(var(--gray));
				line-height: 1.7;
				margin: 0;
			}

			.hero-visual {
				display: flex;
				align-items: center;
				justify-content: center;
			}

			/* Abstract soil food web diagram */
			.soil-web-diagram {
				position: relative;
				width: 280px;
				height: 280px;
			}

			.diagram-svg {
				position: absolute;
				inset: 0;
				width: 100%;
				height: 100%;
			}

			.diagram-label {
				position: absolute;
				font-size: 0.65rem;
				text-transform: uppercase;
				letter-spacing: 0.1em;
				color: rgb(var(--gray));
				font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', monospace;
			}

			.diagram-label-top {
				top: 0.25rem;
				left: 50%;
				transform: translateX(-50%);
			}

			.diagram-label-bottom {
				bottom: 0.25rem;
				left: 50%;
				transform: translateX(-50%);
			}

			.diagram-label-left {
				left: 0.25rem;
				top: 50%;
				transform: translateY(-50%) rotate(-90deg);
				transform-origin: center;
			}

			.diagram-label-right {
				right: 0.25rem;
				top: 50%;
				transform: translateY(-50%) rotate(90deg);
				transform-origin: center;
			}

			.orbit {
				position: absolute;
				border: 1px solid rgba(var(--gray), 0.2);
				border-radius: 50%;
			}

			.orbit-1 {
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
			}

			.orbit-2 {
				width: 70%;
				height: 70%;
				top: 15%;
				left: 15%;
			}

			.orbit-3 {
				width: 40%;
				height: 40%;
				top: 30%;
				left: 30%;
			}

			.node {
				position: absolute;
				border-radius: 50%;
			}

			.node-center {
				width: 24px;
				height: 24px;
				background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
			}

			.node-1 {
				width: 12px;
				height: 12px;
				background: var(--accent-light);
				opacity: 0.8;
				top: 10%;
				left: 48%;
			}

			.node-2 {
				width: 16px;
				height: 16px;
				background: var(--accent);
				opacity: 0.6;
				top: 75%;
				left: 20%;
			}

			.node-3 {
				width: 10px;
				height: 10px;
				background: var(--accent-light);
				opacity: 0.7;
				top: 60%;
				left: 80%;
			}

			.node-4 {
				width: 8px;
				height: 8px;
				background: var(--accent);
				opacity: 0.5;
				top: 25%;
				left: 15%;
			}

			/* Divider */
			.section-divider {
				height: 1px;
				background: linear-gradient(to right, transparent, rgb(var(--gray-light)), transparent);
				margin: 0 0 4rem 0;
			}

			/* Featured Article Section */
			.featured-section {
				display: grid;
				grid-template-columns: 4fr 8fr;
				gap: 2rem;
				padding: 0 0 4rem 0;
			}

			.featured-label {
				font-size: 0.7rem;
				text-transform: uppercase;
				letter-spacing: 0.2em;
				color: rgb(var(--gray));
				margin-bottom: 0.5rem;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.featured-title {
				font-size: 1.75rem;
				font-weight: 300;
				margin-bottom: 1rem;
			}

			.featured-description {
				font-size: 1rem;
				color: rgb(var(--gray));
				line-height: 1.7;
				margin-bottom: 1.5rem;
			}

			.featured-link {
				display: inline-flex;
				align-items: center;
				gap: 0.5rem;
				font-size: 0.875rem;
				color: var(--accent);
				text-decoration: none;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				transition: color 0.2s ease;
			}

			.featured-link:hover {
				color: var(--accent-dark);
			}

			.featured-link svg {
				width: 1rem;
				height: 1rem;
				transition: transform 0.2s ease;
			}

			.featured-link:hover svg {
				transform: translateX(4px);
			}

			/* pH Chart Visualization */
			.chart-container {
				background: white;
				border: 1px solid rgb(var(--gray-light));
				border-radius: 8px;
				padding: 2rem;
				position: relative;
			}

			:root.dark-theme .chart-container {
				background: rgba(255, 255, 255, 0.03);
				border-color: rgba(255, 255, 255, 0.08);
			}

			.chart-label {
				position: absolute;
				top: 1rem;
				right: 1rem;
				font-size: 0.75rem;
				color: rgb(var(--gray));
				font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', monospace;
			}

			.chart-bars {
				display: flex;
				align-items: flex-end;
				gap: 0.25rem;
				height: 8rem;
				margin-top: 1.5rem;
				margin-bottom: 1rem;
			}

			.chart-bar {
				flex: 1;
				border-radius: 2px 2px 0 0;
				transition: opacity 0.2s ease;
			}

			.chart-bar:hover {
				opacity: 0.8;
			}

			.chart-bar.unstable {
				background: #dc2626;
			}

			.chart-bar.transitional {
				background: #f59e0b;
			}

			.chart-bar.stable {
				background: #16a34a;
			}

			.chart-timeline {
				display: flex;
				justify-content: space-between;
				font-size: 0.75rem;
				color: rgb(var(--gray));
				border-top: 1px solid rgb(var(--gray-light));
				padding-top: 0.5rem;
				font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', monospace;
			}

			.chart-legend {
				display: flex;
				gap: 1.5rem;
				margin-top: 1rem;
				font-size: 0.75rem;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.legend-item {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				color: rgb(var(--gray));
			}

			.legend-dot {
				width: 0.75rem;
				height: 0.75rem;
				border-radius: 2px;
			}

			.legend-dot.unstable {
				background: #dc2626;
			}

			.legend-dot.transitional {
				background: #f59e0b;
			}

			.legend-dot.stable {
				background: #16a34a;
			}

			/* Glossary Demo Section */
			.glossary-section {
				background: white;
				border-top: 1px solid rgb(var(--gray-light));
				border-bottom: 1px solid rgb(var(--gray-light));
				margin: 0 calc(-50vw + 50%);
				padding: 4rem calc(50vw - 50%);
			}

			:root.dark-theme .glossary-section {
				background: rgba(255, 255, 255, 0.02);
				border-color: rgba(255, 255, 255, 0.08);
			}

			.glossary-grid {
				display: grid;
				grid-template-columns: 4fr 8fr;
				gap: 2rem;
				max-width: 960px;
				margin: 0 auto;
			}

			.glossary-demo-content {
				background: rgb(var(--gray-light));
				border-radius: 8px;
				padding: 1.5rem;
			}

			:root.dark-theme .glossary-demo-content {
				background: rgba(255, 255, 255, 0.05);
			}

			.glossary-demo-content p {
				font-size: 1.125rem;
				line-height: 1.8;
				margin: 0;
			}

			/* Section styling */
			.content-section {
				padding: 0 0 4rem 0;
			}

			.section-header {
				display: flex;
				justify-content: space-between;
				align-items: baseline;
				margin-bottom: 2rem;
			}

			.section-title {
				font-size: 1.5rem;
				font-weight: 300;
				margin: 0;
			}

			.view-all {
				font-size: 0.875rem;
				color: var(--accent);
				text-decoration: none;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.view-all:hover {
				color: var(--accent-dark);
			}

			/* Article grid */
			ul {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 2rem;
				list-style-type: none;
				margin: 0;
				padding: 0;
			}

			ul li {
				background: white;
				border: 1px solid rgb(var(--gray-light));
				border-radius: 8px;
				overflow: hidden;
				transition: box-shadow 0.2s ease, transform 0.2s ease;
			}

			:root.dark-theme ul li {
				background: rgba(255, 255, 255, 0.03);
				border-color: rgba(255, 255, 255, 0.08);
			}

			ul li:hover {
				box-shadow: 0 8px 30px rgba(var(--gray), 0.15);
				transform: translateY(-2px);
			}

			ul li img {
				width: 100%;
				aspect-ratio: 16/9;
				object-fit: cover;
				border-radius: 0;
				margin: 0;
			}

			ul li a {
				display: block;
				text-decoration: none;
			}

			.card-content {
				padding: 1.25rem;
			}

			.title {
				margin: 0 0 0.5rem 0;
				color: rgb(var(--black));
				line-height: 1.4;
				font-size: 1.1rem;
			}

			.date {
				margin: 0;
				color: rgb(var(--gray));
				font-size: 0.875rem;
			}

			/* Card metadata */
			.card-category {
				font-size: 0.7rem;
				text-transform: uppercase;
				letter-spacing: 0.15em;
				color: var(--accent);
				margin: 0 0 0.25rem 0;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.card-meta {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				margin-top: 0.5rem;
			}

			.difficulty-badge {
				font-size: 0.65rem;
				padding: 0.2rem 0.5rem;
				border-radius: 4px;
				font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			}

			.difficulty-badge.beginner {
				background: #dcfce7;
				color: #166534;
			}

			.difficulty-badge.intermediate {
				background: #fef3c7;
				color: #92400e;
			}

			.difficulty-badge.advanced {
				background: rgb(var(--gray-light));
				color: rgb(var(--gray-dark));
			}

			:root.dark-theme .difficulty-badge.beginner {
				background: rgba(22, 163, 74, 0.2);
				color: #86efac;
			}

			:root.dark-theme .difficulty-badge.intermediate {
				background: rgba(245, 158, 11, 0.2);
				color: #fcd34d;
			}

			:root.dark-theme .difficulty-badge.advanced {
				background: rgba(255, 255, 255, 0.1);
				color: rgb(var(--gray));
			}

			.read-time {
				font-size: 0.75rem;
				color: rgb(var(--gray));
				font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', monospace;
			}

			ul li a:hover .title {
				color: var(--accent);
			}

			@media (max-width: 720px) {
				.hero-section {
					grid-template-columns: 1fr;
					padding: 3rem 0;
					text-align: center;
				}

				.hero-visual {
					order: -1;
				}

				.soil-web-diagram {
					width: 180px;
					height: 180px;
				}

				.hero-title {
					font-size: 2rem;
				}

				.featured-section {
					grid-template-columns: 1fr;
				}

				.glossary-grid {
					grid-template-columns: 1fr;
				}

				.chart-legend {
					flex-wrap: wrap;
					gap: 0.75rem;
				}

				ul {
					grid-template-columns: 1fr;
					gap: 1.5rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="hero-section">
				<div class="hero-content">
					<p class="hero-tagline">Probiotic Cultivation, Decoded</p>
					<h1 class="hero-title">Understanding the science behind living soil systems</h1>
					<p class="hero-description">
						Rigorous explorations of soil biology, fermentation science, and plant physiology—for growers who want to understand the why, not just follow recipes.
					</p>
				</div>
				<div class="hero-visual">
					<div class="soil-web-diagram">
						<!-- SVG crosshair lines -->
						<svg class="diagram-svg" viewBox="0 0 280 280">
							<line x1="140" y1="0" x2="140" y2="280" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4" opacity="0.2" />
							<line x1="0" y1="140" x2="280" y2="140" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4" opacity="0.2" />
							<line x1="40" y1="40" x2="240" y2="240" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4" opacity="0.2" />
							<line x1="240" y1="40" x2="40" y2="240" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4" opacity="0.2" />
						</svg>
						<!-- Labels -->
						<span class="diagram-label diagram-label-top">Atmosphere</span>
						<span class="diagram-label diagram-label-bottom">Substrate</span>
						<span class="diagram-label diagram-label-left">Microbiome</span>
						<span class="diagram-label diagram-label-right">Plant</span>
						<!-- Orbits -->
						<div class="orbit orbit-1"></div>
						<div class="orbit orbit-2"></div>
						<div class="orbit orbit-3"></div>
						<div class="node node-center"></div>
						<div class="node node-1"></div>
						<div class="node node-2"></div>
						<div class="node node-3"></div>
						<div class="node node-4"></div>
					</div>
				</div>
			</section>

			<div class="section-divider"></div>

			<!-- Featured Article Section -->
			<section class="featured-section">
				<div class="featured-info">
					<p class="featured-label">Featured Research</p>
					<h2 class="featured-title">Fermented Plant Extracts</h2>
					<p class="featured-description">
						What actually happens during FPE fermentation? We trace the microbial 
						succession, biochemical transformations, and potential defense pathway 
						activation—separating science from tradition.
					</p>
					<a href={`${import.meta.env.BASE_URL}/articles/impact-of-LAB/`} class="featured-link">
						<span>Read the full analysis</span>
						<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
						</svg>
					</a>
				</div>
				<div class="featured-chart">
					<div class="chart-container">
						<span class="chart-label">Fig. 1 — Fermentation Timeline</span>
						<div class="chart-bars">
							{phData.map((ph) => (
								<div 
									class={`chart-bar ${ph > 4.6 ? 'unstable' : ph > 4.0 ? 'transitional' : 'stable'}`}
									style={`height: ${(ph / 7) * 100}%`}
								/>
							))}
						</div>
						<div class="chart-timeline">
							<span>Day 0</span>
							<span>Day 7</span>
							<span>Day 14</span>
						</div>
						<div class="chart-legend">
							<div class="legend-item">
								<div class="legend-dot unstable"></div>
								<span>pH &gt; 4.6 (unstable)</span>
							</div>
							<div class="legend-item">
								<div class="legend-dot transitional"></div>
								<span>pH 4.0–4.6 (transitional)</span>
							</div>
							<div class="legend-item">
								<div class="legend-dot stable"></div>
								<span>pH &lt; 4.0 (stable)</span>
							</div>
						</div>
					</div>
				</div>
			</section>

			<div class="section-divider"></div>

			<section class="content-section">
				<div class="section-header">
					<h2 class="section-title">Latest Articles</h2>
					<a href={`${import.meta.env.BASE_URL}/articles/`} class="view-all"
						>View all articles →</a
					>
				</div>
				<ul>
					{
						articles.map((post) => (
							<li>
								<a href={`${import.meta.env.BASE_URL}/articles/${post.id}/`}>
									{post.data.heroImage && (
										<Image
											width={400}
											height={225}
											src={post.data.heroImage}
											alt=""
										/>
									)}
									<div class="card-content">
										{post.data.category && (
											<p class="card-category">{post.data.category}</p>
										)}
										<h4 class="title">{post.data.title}</h4>
										<div class="card-meta">
											{post.data.difficulty && (
												<span class={`difficulty-badge ${post.data.difficulty}`}>
													{post.data.difficulty.charAt(0).toUpperCase() + post.data.difficulty.slice(1)}
												</span>
											)}
											{post.data.readTime && (
												<span class="read-time">{post.data.readTime} read</span>
											)}
										</div>
									</div>
								</a>
							</li>
						))
					}
				</ul>
			</section>

			<section class="content-section">
				<div class="section-header">
					<h2 class="section-title">Featured Tutorials</h2>
					<a href={`${import.meta.env.BASE_URL}/tutorials/`} class="view-all"
						>View all tutorials →</a
					>
				</div>
				<ul>
					{
						tutorials.map((post) => (
							<li>
								<a href={`${import.meta.env.BASE_URL}/tutorials/${post.id}/`}>
									{post.data.heroImage && (
										<Image
											width={400}
											height={225}
											src={post.data.heroImage}
											alt=""
										/>
									)}
									<div class="card-content">
										<h4 class="title">{post.data.title}</h4>
										<div class="card-meta">
											{post.data.difficulty && (
												<span class={`difficulty-badge ${post.data.difficulty}`}>
													{post.data.difficulty.charAt(0).toUpperCase() + post.data.difficulty.slice(1)}
												</span>
											)}
											{post.data.timeToComplete && (
												<span class="read-time">{post.data.timeToComplete}</span>
											)}
										</div>
									</div>
								</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>

		<!-- Glossary Demo Section -->
		<section class="glossary-section">
			<div class="glossary-grid">
				<div class="glossary-info">
					<p class="featured-label">Interactive Glossary</p>
					<h2 class="featured-title">Hover to learn</h2>
					<p class="featured-description">
						Technical terms throughout the site are linked to our glossary. 
						Hover over highlighted terms for quick definitions, or click 
						to explore the full entry.
					</p>
				</div>
				<div class="glossary-demo-content">
					<p>
						When cultivating with living soil methods, understanding the role of
						<GlossaryTerm term="LAB" /> is essential. These microorganisms interact with plant
						<GlossaryTerm term="SAR" /> pathways, potentially enhancing both defense responses and secondary 
						metabolite production through <GlossaryTerm term="FPE" /> applications.
					</p>
				</div>
			</div>
		</section>

		<Footer />
	</body>
</html>
