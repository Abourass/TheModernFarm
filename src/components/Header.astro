---
import { SITE_TITLE } from "../consts";
import HeaderLink from "./HeaderLink.astro";
---

<header>
    <nav>
        <div class="site-section">
            <h2 class="site-title">
                <a href="/TheModernFarm/">{SITE_TITLE}</a>
            </h2>
        </div>
        <div class="internal-links">
            <HeaderLink href="/TheModernFarm/">Home</HeaderLink>
            <HeaderLink href="/TheModernFarm/articles">Articles</HeaderLink>
            <HeaderLink href="/TheModernFarm/tutorials">Tutorials</HeaderLink>
            <HeaderLink href="/TheModernFarm/about">About</HeaderLink>
        </div>
        <div class="social-links">
        <button id="theme-toggle" aria-label="Toggle dark mode">
            <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>
            <a href="https://discord.gg/2h7psMzv" target="_blank">
                <span class="sr-only">Join the Modern Farm discord!</span>
                <svg
                    viewBox="0 0 16 16"
                    aria-hidden="true"
                    width="32"
                    height="32"
                >
                    <path
                        fill="currentColor"
                        d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z"
                    ></path>
                </svg>
            </a>
            <a href="https://github.com/Abourass/TheModernFarm" target="_blank">
                <span class="sr-only">Go to TheModern.Farm's GitHub repo</span>
                <svg
                    viewBox="0 0 16 16"
                    aria-hidden="true"
                    width="32"
                    height="32"
                    ><path
                        fill="currentColor"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
                    ></path></svg
                >
            </a>
        </div>
    </nav>
</header>

<script>
    // Theme toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    const rootElement = document.documentElement;
    
    function updateThemeIcon(isDark: boolean) {
        if (sunIcon && moonIcon) {
            // show sun in dark mode, moon in light mode
            sunIcon.style.display = isDark ? 'block' : 'none';
            moonIcon.style.display = isDark ? 'none' : 'block';
        }
    }

    function setTheme(theme: string) {
        const isDark = theme === 'dark';
        rootElement.classList.toggle('dark-theme', isDark);
        document.body.classList.toggle('dark-theme', isDark);
        updateThemeIcon(isDark);
        localStorage.setItem('theme', theme);
    }
    
    // Check current theme state on load and update icon
    const currentTheme = rootElement.classList.contains('dark-theme') ? 'dark' : 'light';
    updateThemeIcon(currentTheme === 'dark');
    
    // Listen for OS theme preference changes
    const prefersDarkMedia = window.matchMedia('(prefers-color-scheme: dark)');
    prefersDarkMedia.addEventListener('change', (e) => {
        // Only apply OS changes if user hasn't manually set a preference
        if (!localStorage.getItem('theme')) {
            setTheme(e.matches ? 'dark' : 'light');
        }
    });
    
    // Toggle theme when button is clicked
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const newTheme = rootElement.classList.contains('dark-theme') ? 'light' : 'dark';
            setTheme(newTheme);
        });
    }
</script>

<style>
    header {
        margin: 0;
        padding: 0 1em;
        background: var(--background-color);
        box-shadow: 0 2px 8px rgba(var(--black), 5%);
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    h2 {
        margin: 0;
        font-size: 1em;
    }

    h2 a,
    h2 a.active {
        text-decoration: none;
        color: var(--heading-color);
    }
    nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .site-section {
        width: 272.77px; /* Match the width of the site title */
    }
    .social-links {
        width: 272.77px; /* Same width as site title for balance */
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 0.5em;
    }
    .social-links a {
        display: flex;
    }
    nav a {
        padding: 1em 0.5em;
        color: var(--text-color);
        border-bottom: 4px solid transparent;
        text-decoration: none;
    }
    nav a.active {
        text-decoration: none;
        border-bottom-color: var(--accent);
    }
    #theme-toggle {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5em;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-color);
        position: relative;
        width: 32px;
        height: 32px;
    }
    #sun-icon, #moon-icon {
        width: 30px;
        height: 30px;
        position: absolute;
        transition: fill 0.3s ease;
        fill: none;
    }
    #moon-icon {
        display: none;
    }

    /* Light mode styles */
    :root:not(.dark-theme) #moon-icon:hover {
        fill: rgba(var(--gray-dark), 1);
    }
    
    /* Dark mode styles */
    :root.dark-theme #sun-icon:hover {
        fill: rgba(255, 255, 150, .8);
    }

    :root.dark-theme .site-title a{
        color: #fff;
    }

    @media (max-width: 720px) {
        .social-links {
            width: auto;
        }
        .social-links a:not(:first-child) {
            display: none;
        }
        /* Ensure internal links stay centered on mobile */
        .site-section {
            width: 50%;
        }
        .internal-links {
            width: 50%;
            display: flex;
            justify-content: flex-end;
        }
    }
</style>
